steps:
  - script: |
      echo Master check
    displayName: Master branch check
    condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))

  - script: |
      set -e
      cargo test --release
    displayName: Cargo tests on Unix
    condition: not(eq(variables['Agent.OS'], 'Windows_NT'))
  - script: |
      echo "Set LLVM variable"

      for /f "tokens=*" %%i in ('vswhere -latest -products * -requires Microsoft.VisualStudio.Component.VC.Llvm.Clang -property installationPath') do set LIBCLANG_PATH="%%i\Tools\Llvm\bin"
      echo "Clang Path " %LIBCLANG_PATH%

      pushd %LIBCLANG_PATH%
      dir
      popd

      cargo test --release
    displayName: Cargo tests on Windows
    condition: eq(variables['Agent.OS'], 'Windows_NT')